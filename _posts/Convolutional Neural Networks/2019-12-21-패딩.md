---
layout: post
title: "패딩"
tags: [padding]
categories: [Convolutional Neural Networks]
---

# 학습 목표
- 합성 곱에서 사용하는 패딩을 배운다.

# 핵심 키워드
- 패딩

# 학습 내용
- 이전에 사용했던 방법은 두가지 단점이 있습니다.
  - 계속 합성곱 연산을 하게되면 이미지가 계속 축소됩니다.
  - 가장자리 픽셀은 단 한번만 사용됩니다. 즉, 덜 사용됨으로서 이미지 윤곽쪽의 정보를 버리게 됩니다.
- 이를 해결하기 위해서 패딩이라는 방법을 사용합니다. 패딩은 이미지 주위에 추가로 하나의 경계를 덧대는 것입니다. 그러므로 인해서 이미지크기가 조금 커집니다. 보통 숫자 0을 사용합니다.
- 최종 이미지 크기 : (n + 2p - f + 1)^2
  - n : 이미지 크기
  - p : 패딩 크기
  - f : 필터 크기
- 일반적으로 필터의 크기는 홀수입니다. 그이유는 두가지 입니다.
  - 첫째, 패딩이 비대칭이 됩니다. 홀수일때 합성곱에서 동일한 크기로 패딩을 더해줄 수 있고, 짝수면 왼쪽과 오른쪽을 다르게 패딩해야하기 때문에 번거롭습니다.
  - 둘째, 중심위치가 존재합니다.
  
# 이전의 단점 두가지
![image](https://user-images.githubusercontent.com/50114210/71306339-43035000-2422-11ea-8f54-bc93f8f51372.png)          
이전의 영상에서 봤던 것은 6 x 6 이미지를 가지고 3 x 3 필터의 합성곱 연산으로 4 x 4 의 행렬을 얻었습니다
왜냐하면 3 x 3 필터에서는 6 x 6 행렬에 맞는 위치가 4 x 4 개가 있기 때문이죠
여기에서 필요한 계산은 n x n 이미지를 f x f 필터로 합성곱을 한 결과는 n - f + 1 x n - f + 1 입니다
이 예시에서는 6 - 3 + 1 은 4 가 되어서 4 x 4 의 결과 이미지를 얻게 되죠

### 이미지가 축소된다
이 방법에 두 가지 단점이 있는데 하나는 합성곱 연산을 할 때마다 이미지가 축소된다는 것입니다
그래서 6 x 6 이미지가 4 x 4 가 되었죠
만약 이 작업을 여러 번 반복한다면 이미지가 굉장히 작아질 것입니다
1 x 1 만큼 축소 될지도 모르죠
윤곽선을 검출하거나 어떤 특성들을 찾아내려고 할 때마다 이미지가 축소되는 걸 원하지는 않을 겁니다
이것이 첫 번째 단점입니다

### 가장자리가 사용이 덜 된다.
그리고 두 번째 단점은 여기 가장자리의 픽셀을 보면 결과 이미지에 단 한 번만 사용됩니다
이 3 x 3 영역에만 걸치기 때문이죠
만약 중간에 있는 이 픽셀을 살펴보면 여러 개의 3 x 3 영역에 걸쳐있습니다
그래서 가장자리나 모서리에 있는 픽셀은 그만큼 결과 이미지에 덜 사용되는 것입니다
가장자리 근처의 정보들은 거의 날려버리게 되는 것이죠

# 패딩
![image](https://user-images.githubusercontent.com/50114210/71306350-51ea0280-2422-11ea-8e42-3c4676493a06.png)                 
이 두 문제를 해결하기 위해서는 합성곱 연산을 하기 전에 이미지를 덧대는 것입니다
이 경우에는 추가로 하나의 경계를 덧대는 것이죠
1 픽셀만큼 가장자리에 더해주는 것입니다
그렇게 되면 이제 6 x 6 이미지가 아닌 8 x 8 이미지가 되는 것이죠
이제 8 x 8 이미지를 3 x 3 필터와 합성곱을 하면
4x4 이미지가 아닌 6 x 6 이미지를 얻게 됩니다  기존의 크기를 유지하게 된 것이죠
0 을 덧대는 것이 일반적인데 만약 p 가 패딩의 양이라면 이 경우에는 p 는 1 입니다
왜냐하면 1 픽셀만큼 추가로 가장자리에 더해줬기 때문이죠
그래서 결과 이미지는 n + 2p - f + 1 x n + 2p - f + 1
그래서 이 경우에는 6 + 2 - 3 + 1 과 반대에도 똑같이 하면 6 + 2 - 3 + 1 은 6 입니다
그래서 6 x 6 이미지를 얻게 되고 기존의 크기를 유지할 수 있죠
이 초록색 픽셀은 결과 이미지의 이 부분에 영향을 줍니다
이렇게 함으로써 버리는 건 아니지만 가장자리의 정보를 덜 가져오는 일을 줄일 수 있게 됩니다
지금 보여준 패딩은 1 픽셀 만큼의 크기이고 원한다면 2 픽셀도 가능합니다
또다른 경계를 덧대주면 더 많은 픽셀도 가능하죠 그래서 지금 그린 것은 p 가 2 인 패딩입니다.            

# 두가지 종류의 패딩
패딩을 얼마 만큼 할 것이냐에는 두 가지 선택지가 있는데 유효 합성곱과 동일 합성곱입니다

### 유효 합성곱
![image](https://user-images.githubusercontent.com/50114210/71306356-65956900-2422-11ea-81d4-790352faff29.png)            
좋은 이름인지는 잘 모르겠습니다 유효 합성곱이 의미하는 것은 패딩이 없는 것입니다
이 경우에는 n x n 이미지를 f x f 필터와 합성곱을 해서         
n - f + 1 x n - f + 1 크기의 결과 이미지가 나오게 됩니다
이전 영상에서 봤던 예시에 해당하는데 6 x 6 이미지를  3 x 3 필터와
합성곱을 해서 4 x 4 의 결과가 나왔습니다

### 동일 합성곱
![image](https://user-images.githubusercontent.com/50114210/71306359-7514b200-2422-11ea-8dc2-e503a82fa519.png)              
또다른 일반적인 선택지는 동일 합성곱입니다
패딩을 한 뒤 결과 이미지의 크기가 기존 이미지와 동일하기 때문이죠
이 공식을 그대로 따라서 만약 p 픽셀 만큼 패딩을 더한다면
n 이 n + 2p 로 바뀌고 나머지는 그대로 - f + 1 입니다
그래서 n x n 이미지에 p 픽셀 만큼 패딩을 더한다면 결과 이미지의 크기는
n + 2p - f + 1 x n + 2p - f + 1 가 되죠
만약 n + 2p - f + 1 이 n 이 되어서 결과의 크기가 기존의
크기와 같게 하려면 이 식을 풀면 되는데 n 은 양변에서 소거되고
p 에 대한 식으로 풀면 p 는 (f - 1) / 2 가 됩니다
만약 f 가 홀수라면 이런 식으로 p 를 설정하면 결과가 이미지의 크기가
기존의 이미지와 같아질 수 있습니다
그래서 예제에서 필터의 크기가 3 x 3 이었을 때 결과와 입력 크기를 같게 해주는
패딩의 크기가 (3 - 1) / 2 = 1 이 되는 것이죠
또다른 예시로는 만약 필터가 5 x 5 다시 말해 f 가 5 이면
만약 필터가 5 x 5 다시 말해 f 가 5 일 때 이 식에 대입해보면
2 의 크기의 패딩으로 필터의 크기가 5 x 5 일 때 결과와 입력의 크기가 같게 되죠

# 필터의 크기는 보통 홀수
일반적으로 컴퓨터 비전에서 f 는 홀수입니다
거의 항상 홀수죠 컴퓨터 비전에서는 짝수의 필터를 거의 볼 수 없습니다

### 이유 1. 패딩이 비대칭이 되어서
두 가지 이유가 있는데 첫째는 만약 f 가 짝수라면 패딩이 비대칭이 됩니다
f 가 홀수일 때만 합성곱에서 동일한 크기로 패딩을 더해줄 수 있고
짝수면 왼쪽과 오른쪽이 서로 다르게 패딩을 해줘야 하죠

### 이유 2. 관습
둘째는 만약 홀수 크기의 필터가 있으면 3 x 3 이나 5 x 5 의 경우에는
중심 위치가 존재합니다 컴퓨터 비전에서는 구별된 하나의 픽셀이 있어서
중심 픽셀로 부르고 필터의 위치에 사용하는 것이 좋죠
어쩌면 이것들이 f 를 홀수로 하는 좋은 이유가 아닐지 모르지만
컴퓨터 비전 문헌들을 보면 3 x 3 필터가 매우 일반적이고 5 x 5 나 7 x 7 도 사용되죠
이후에는 1 x 1 필터와 그 용도에 대해 다뤄볼 것입니다
하지만 일반적으로는 홀수의 필터를 사용하기를 권장합니다
비록 짝수의 f 를 사용해도 괜찮은 성능을 보여주지만
컴퓨터 비전의 관습에 따라 저는 주로 홀수의 f 를 사용합니다
이렇게 해서 패딩을 더한 합성곱 연산에서 패딩의 양을 정해줄 때
p 의 값을 정해줘도 되고 또는 유효 합성곱이라 p 를 0 으로 두어도 되고
또 동일 합성곱이어서 결과 이미지가 입력과 크기가 같도록 패딩을 설정해줄 수도 있습니다
