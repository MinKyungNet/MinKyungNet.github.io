---
layout: post
title: "데이터 확대"
tags: [data augmentation, cropping, distortion, batch]
categories: [Convolutional Neural Networks]
---

# 학습 목표
- 데이터 확대방법에 대해 알아본다.

# 핵심 키워드
- 데이터 확대
- 크로핑
- 변형
- 배치

# 학습 내용
- 데이터가 부족하면 데이터 확대를 사용하기도 합니다. 데이터 확대는 다양한 방법이 있습니다.
  - 수직축 대칭
  - 무작위 크로핑
    - 데이터의 일부분을 잘라내서 훈련 데이터로 사용합니다.
  - 회전
  - 비틀기
  - 색변환
    - 이미지의 RGB채널에 각각 다른 수를 더해주는 방식입니다.
    - 이 방법이 가능한 이유는 햇빛의 변화에도 해당 타겟의 정체성 정보는 손실되지 않기 때문입니다.
- 데이터의 변형 구현은 주로 cpu 스레드를 통해서 데이터를 불러옴과 동시에 변형을 시켜 배치를 형성합니다.

# 인트로
대부분의 컴퓨터 비전 작업은 더 많은 데이터를 사용할 수 있습니다           
데이터 확대는 컴퓨터 비전의 성능을 향상시키는 기술의 일종이죠           
컴퓨터 비전은 매우 복잡한 작업입니다 이미지와 픽셀들을 입력 받아서           
사진에 있는 것을 식별해야 하는데 꽤나 복잡한 함수를 학습해야 하죠           
실제로는 더 많은 데이터가 거의 모든  컴퓨터 비전 작업에 도움을 줍니다           
더 많은 데이터에 대한 부담을 느끼지 않는 다른 작업과는 다르죠           
오늘 날의 컴퓨터 비전에서는 대부분의 문제들에서 우리는 데이터의 부족을 느낍니다           
머신 러닝의 모든 응용 분야에서 그런 것은 아니지만 컴퓨터 비전 분야에서는 그렇습니다           
그래서 컴퓨터 비전 모델을 훈련할 때 데이터 확대는 많은 도움이 됩니다           
전이 학습을 통해 누군가가 미리 훈련시킨 가중치를 쓸 때나           
직접 처음부터 훈련시킬 때 모두 해당되죠           
그러면 컴퓨터 비전에서 일반적인 데이터 확대 방법을 살펴봅시다           

# 대칭, 크로핑 등의 확대 방식
![image](https://user-images.githubusercontent.com/50114210/71525302-71969480-2914-11ea-9b0a-7a66545a5575.png)                   
가장 간단한 데이터 확대 방식은 수직 축 대칭입니다           
훈련 세트에 이런 예를 뒤집어서 오른쪽 이미지로 만드는 것이죠           
대부분의 컴퓨터 비전에서는 왼쪽 그림이 고양이라면 대칭 그림도 역시 고양이입니다           
만약 대칭 작업이 그림에서 인식하려는 것을 보존한다면 좋은 데이터 확대 기술이 되겠죠           
또 자주 사용되는 기술은 바로 무작위 크로핑입니다           
무작위로 한 부분을 잘라볼텐데 이 부분을 자르고 또 이 부분을 자르고           
또 이 부분을 잘라내면 훈련 세트에 넣을 서로 다른 예시가 될 수 있습니다           
무작위 크로핑은 완벽한 데이터 확대 방식은 아닙니다           
만약 이 부분을 무작위 잘라냈다면 고양이 같이 보이지는 않죠           
하지만 실제로는 잘 작동합니다 무작위로 잘라낸 이미지가 꽤나 큰 부분을 제공하기 때문이죠           
그래서 대칭과 무작위 크로핑은 빈번하게 사용됩니다           
이론적으로는 회전과 이미지를 비트는 것과 또 이미지를 뒤틀기도 하고           
이런 것들을 전부 사용하지만 실제로 많이 사용되지는 않죠           
복잡하기 때문에 그렇습니다           

# 색변환
![image](https://user-images.githubusercontent.com/50114210/71525314-79563900-2914-11ea-9eae-6c39a0274e0d.png)                
두 번째로 많이 사용되는 데이터 확대 방식은 색변환입니다         
이런 사진이 있을 때 RGB 각 채널에 서로 다른 수를 더해주는 것이죠         
이 경우에는 빨강과 파랑 채널은 더해주고 초록 채널은 빼줬습니다         
빨강과 파랑이 더해지만 보라색이라 이미지가 보라색에 가까워졌죠         
이렇게 변형된 이미지를 생성하게 되는 것입니다         
여기서는 보여주기 위해 색깔에 큰 변화를 주었는데          
실제로는 RGB 에 아주 작은 변화만 줍니다         
그래서 여러 개의 서로 다른 RGB 값을 정해서 색 채널을 변형시키는 것이죠         
두 번째 예시에서는 빨강이 적고 초록과 파랑을 더해줘서 전체적으로 노란 빛이 돕니다         
여기서는 파란색에 가깝게 만들었죠         
하지만 실제로는 RGB 값이 특정 확률분포에 따라 정해집니다         
이 방법의 동기는 만약 햇빛이 조금 더 노란빛이거나          
조명이 더 노란색이라면 이미지의 색을 바꿀 수도 있는데          
그 고양이 또는 내용 정보인 Y 의 정체성은 변하지 않기 때문이죠         
이러한 색변형을 통해서 학습 알고리즘이 색의 변화에 더 잘 반응할 수 있게 해줍니다         

# 추가
더 알고 싶은 학생들을 위해 몇 가지 알려드릴 것인데         
여기 빨간 글씨로 쓴 것은 이해하지 못해도 괜찮습니다         
RGB 의 표본을 만드는 방식에는 여러 가지가 있습니다         
색 변형을 하는 방법 중 하나가 PCA 라는 알고리즘을 사용하는 것이죠         
주성분분석이라고 제가 머신 러닝 그룹에서 가르쳤던 것입니다         
ml-class.org 의 머신 러닝 강좌에서 말이죠         
이것의 세부적인 부분은 AlexNet 논문에 제시되어 있고 종종 PCA 색 확대 라고 불립니다         
PCA 색 확대의 대략적인 개념은 만약 이미지의 주된 색이 보라색이라면          
빨강과 파랑이 주이고 초록색은 조금만 있다면          
PCA 색 확대는 빨강과 파랑에 큰 수를 더하거나 빼고         
초록색에는 상대적으로 적게 해줌으로써 전체적인 색조를 유지해줍니다         

# 데이터 변환 방식
![image](https://user-images.githubusercontent.com/50114210/71525336-83783780-2914-11ea-9b20-537a7a4a270d.png)                        
훈련 데이터는 아마 하드 디스크에 저장되어 있을 것입니다                
이런 바구니 모양으로 하드 디스크를 표현해보죠                
만약 작은 훈련 세트를 가지고 있다면 거의 모든 것을 할 수 있겠지만                
아주 큰 훈련 세트에서는 CPU 쓰레드가 있으면 계속해서 이미지를                
하드 디스크로부터 불러오는데 그래서 하드디스크로부터 오는 이미지의 흐름이 생깁니다                
그래서 CPU 쓰레드를 이용해 변형을 구현하는 것이죠                
무작위 크로핑이나 색 변환이나 대칭을 사용해서 말입니다                
그래서 각각의 이미지는 변형된 형태로 남을텐데                 
이 이미지를 대칭이동 하고 또 색 변환도 할 수 있겠죠                
이 이미지는 색 변환된 채로 다른 색의 고양이가 되겁니다                
그래서 CPU 쓰레드는 계속해서 데이터를 불러오는 동시에                
변형이 필요할 때 구현해줌으로써 소형 배치를 형성하게 됩니다                
이 데이터는 또 계속해서 다른 프로세스에 전달되어서                
훈련을 실행하게 되는데 이것은 CPU 나 신경망이 크다면 GPU 에서 이루어집니다                
데이터 확대를 구현하는 일반적인 방법은 이런 하나의 쓰레드나                
혹은 여러 개의 쓰레드로 데이터를 불러오고 변형을 구현해주고                
그것을 다른 쓰레드나 프로세스에 전달해준 뒤                
학습을 실행하고 또 이것과 이것은 동시에 실행될 수 있습니다                

# 아웃트로
여기까지가 데이터 확대였습니다 심층 신경망을 훈련하는 다른 분야와 마찬가지로                
데이터 확대도 몇 개의 하이퍼파라미터를 가집니다                
얼마만큼 색 변환을 할 건지 혹은 무작위 크로핑을 할 건지 말이죠                
컴퓨터 비전의 다른 부분과 마찬가지로 오픈 소스를 사용해서 시작하는 것이                
다른 이들의 데이터 확대 방식을 이용해 쉽게 접근할 수 있습니다                
하지만 만약 다른 이들의 오픈소스에는 없는 것을 찾기 원한다면                
이런 하이퍼파라미터들을 직접 조정할 수도 있습니다                
