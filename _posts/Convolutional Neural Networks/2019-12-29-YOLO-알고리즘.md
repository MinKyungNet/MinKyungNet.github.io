---
layout: post
title: "YOLO 알고리즘"
tags: [YOLO, anchor box, bounding box, Non-max suppression]
categories: [Convolutional Neural Networks]
---

# 학습 목표
- YOLO 물체 감지 알고리즘을 배운다.

# 핵심 키워드
- YOLO
- 앵커 박스
- 경계 박스
- 비-최대값 억제

# 학습 내용
- 지금까지 배운 내용으로 YOLO 물체 감지 알고리즘을 구성해봅니다. 3개의 물체를 검출하는 알고리즘을 훈련시킨다고 생각해봅시다.
- 최종 출력 격자 셀에 맞춰 훈련 세트의 타겟 벡터를 생성합니다.
  - 타겟 벡터 크기 : 격자 높이 * 격자 넓이 * (앵커박스 개수 * 결과값 벡터)
  - 결과값 벡터 : [물체 존재 여부, 중심값, 경계 상자 값, 클래스들]
- 예측시, 잘 훈련되었다면, 물체가 존재할때, 각 앵커박스에 대한 존재 여부 확률이 1에 가까울 것이고 격자 셀에 해당 되는 중심값과 경계박스 값, 그리고 클래스 확률을 출력할 것입니다. 최종적으로 모든 격자 셀에 대해서 비-최댓값 억제를 적용합니다.

# 인트로
여러분은 이미 물체 감지의  대부분의 요소들을 보았습니다            
이번 영상에서는 이 요소들을 한 데 모아 YOLO 물체 감지 알고리즘을 구성해봅시다            

# 데이터 세트 구성
![image](https://user-images.githubusercontent.com/50114210/71547323-129f5100-29e2-11ea-86b4-d7405301d576.png)       
먼저 어떻게 훈련 세트를 구성하는지 살펴봅시다            
보행자, 자동차, 오토바이의 세 가지 물체를 검출하는 알고리즘을 훈련시킨다고 생각해봅시다            
배경에 해당하는 클래스는 필요없으니 3개의 클래스만 있다고 합시다            
만약 두 개의 앵커 박스를 사용한다면 3×3 격자를 사용하므로            
결과값 y는 3×3에 앵커의 수인 2를 곱하고 이것의 차원인 8을 곱합니다            
8은 5에 클래스의 수를 더한 것입니다 5는 Pc와 경계 상자를 의미합니다            
그게 5이고 여기에 c1, c2, c3가 더해집니다 이것의 차원은 클래스의 수와 같습니다             
이걸 3×3×2×8로 볼 수도 있고 3×3×16으로 볼 수도 있습니다             
훈련 세트를 구성하기 위해서 9개의 격자 셀에 대해서 적절한 표적 벡터 y를 생성합니다             
첫 번째 격자 셀을 보면 여기에는 보행자, 자동차, 오토바이              
세 개의 클래스 중 아무것도 감지되지 않습니다 왼쪽 위 격자 셀에 말이죠             
따라서 이 격자 셀의 표적 벡터 y는 다음과 같습니다             
첫 번째 앵커 박스의 Pc는 0입니다 첫 번째 앵커 박스와 연관된 것이 없기 때문이죠             
두 번째 앵커 박스 또한 0입니다 다른 모든 값들은 신경 쓰지 않습니다             
대부분의 격자 셀에는 아무것도 없지만 여기 이 박스는 이 표적 벡터 y를 가집니다             
훈련 세트가 자동차에 대해 이런 경계 상자를 가진다고 하면 세로보다 가로가 약간 더 깁니다             
따라서 만약 이게 앵커 박스 1, 2라면 빨간 박스는 앵커 박스 2와 약간 더 높은 IOU를 갖습니다             
따라서 자동차는 벡터의 아래 부분과 연관됩니다             
앵커 박스 1에 대한 Pc는 0이고 나머지는 신경 쓰지 않습니다             
이 Pc는 1이고 이것들을 사용해서 빨간 경계 상자의 위치를 구체화합니다             
그러고 나서 그 물체가 클래스 2인 자동차라는 것을 구체화합니다             
이 과정을 3×3 격자의 9개의 격자 셀에 대해 적용해서 이런 16차원 벡터를 구할 수 있습니다             
따라서 최종 결과의 부피는 3×3×16이 되고 이 슬라이드에서는 단순함을 위해             
3×3 격자를 사용했지만 일반적으로는 19×19×16처럼 더 많은 격자가 사용됩니다             
또는 더 많은 앵커 박스를 사용하면 19×19×5×8이나 19×19×40이 될 수도 있습니다             
5개의 앵커 박스를 사용하는 경우에 말이죠             
그게 훈련이고 여러분은 신경망을 훈련시킵니다             
신경망은 100×100×3 이미지를 입력값으로 받아서 결과 부피를 도출합니다             
우리 예시에서는 3×3×16 또는 3×3×2×8입니다             

# 신경망의 예측
![image](https://user-images.githubusercontent.com/50114210/71547326-21860380-29e2-11ea-92b4-29bf6890275f.png)     
다음으로 알고리즘이 어떻게 예측을 하는지 봅시다           
이미지가 주어지면 신경망은 3×3×2×8 부피를 도출합니다           
각각의 9개의 격자 셀에 대해 이런 벡터를 얻게 됩니다           
만약 이 왼쪽 위 격자 셀에 아무 물체도 없다면 신경망은 여기와 여기에 0을 도출할 것입니다           
그리고 어떤 값들을 도출합니다           
신경망은 물음표를 도출할 수 없기 때문에 어떤 숫자들을 도출합니다           
하지만 신경망이 여기에 물체가 없다고 하고 있기 때문에 이 숫자들은 기본적으로 무시됩니다           
그래서 경계 상자와 클래스로 어떤 값이 도출되든지 간에 그건 그냥 상관 없는 노이즈입니다           
반대로 이 박스에서는 가운데 아래 이 박스에 대한 결과값 y는 경계 상자 1에 대해서 0           
나머지 숫자는 의미 없는 것들이고 그리고 자동차에 대해            
꽤 정확한 경계 상자를 구체화하는 숫자들도 도출될 것입니다           
이게 신경망이 예측을 하는 방식입니다 마지막으로 여기에 비-최댓값 억제를 적용합니다           

# 예제
![image](https://user-images.githubusercontent.com/50114210/71547333-2f3b8900-29e2-11ea-8daf-fe088af61da6.png)               
흥미를 돋우기 위해 새로운 훈련 세트 이미지를 사용합시다          
이게 비-최댓값 억제를 실행하는 방식입니다          
만약 두 개의 앵커 박스를 사용한다면 9개의 격자 셀 각각에 대해서           
두 개의 경계 상자가 도출될 것입니다          
그 중 일부는 아주 낮은 확률 Pc를 가지겠지만           
어쨌든 9개의 격자 셀 모두 두 개의 경계 상자를 갖습니다          
이것들이 도출된 경계 상자입니다          
어떤 경계 상자들은 격자 셀의 밖으로 나와 있을 수도 있습니다          
다음으로 낮은 확률 예측을 제거합니다          
신경망이 물체가 거기 있을지도 모른다고 했더라도 그것들을 제거합니다          
마지막으로 만약 여러분이 보행자, 자동차, 오토바이의 세 가지 클래스를 감지하려고 한다면            
각각의 세 클래스에 대해서 그 클래스로 감지된 물체에 대해서           
독립적으로 비-최댓값 억제를 실행합니다           
보행자 클래스의 예측에 대해 비-최댓값 억제를 실행하고            
자동차 클래스와 오토바이 클래스에 대해서도 비-최댓값 억제를 실행합니다           
최종 예측을 얻기 위해서 총 세 번 실행합니다           
이것의 결과값은 아마도 모든 자동차와 보행자가 검출된 것입니다           
이것이 YOLO 물체 감지 알고리즘입니다           

# 아웃트로
이것은 가장 효율적인 물체 감지 알고리즘 중 하나입니다           
물체 감지에 대한 컴퓨터 문헌 전체의 많은 아이디어들을 포함해서요           
