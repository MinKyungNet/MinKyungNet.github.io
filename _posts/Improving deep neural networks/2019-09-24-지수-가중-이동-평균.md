---
layout: post
title: "지수 가수 이동 평균"
tags: [Exponentially Weighted Average]
categoires: [Improving deep neural networks]
---

# 학습 목표
지수 가수 이동 평균을 계산할 수 있다.

# 핵심 키워드
지수 가수 이동 평균(Exponentially Weighted Average)

# 학습 내용
* 앞 강의에서 배운 경사 하강법 및 미니배치 경사 하강법보다 더 효율적인 알고리즘을 이해하기 위해 지수 가중 이동 평균을 먼저 이해해야 합니다.
* 최근의 데이터에 더 많은 영향을 받는 데이터들의 평균 흐름을 계산하기 위해 지수 가중 이동 평균을 구합니다. 지수 가중 이동 평균은 최근 데이터 지점에 더 높은 가중치를 줍니다.
* 세타t를 t번째 날의 기온이라고 했을 때, 지수 가중 이동 평균(vt)의 식은 다음과 같습니다.
* vt = b * vt-1 + (1-b) * 세타t
* 이 때 b값은 하이퍼 파라미터로 최적의 값을 찾아야 하는데, 보통 사용하는 값은 0.9입니다.
* vt는 1 / (1 - b) 기간 동안 기온의 평균을 의미합니다.
  - b = 0.9일때 10일의 기온 평균
  - b = 0.5일때 2일의 기온 평균

# 인트로
경사 하강법보다 빠른 몇 가지 최적화 알고리즘을 보여드리고 싶습니다.      
그 알고리즘들을 이해하기 위해서는 지수가중평균을 사용할 수 있어야 합니다.      
통계학에서 지수가중이동평균이라고도 불립니다.          
먼저 이것에 대해 이야기하고 가장 정교한 최적화 알고리즘을 구현하는데 사용할 것입니다.            

# 연속성이 있는 데이터
![image](https://user-images.githubusercontent.com/50114210/65482421-046a0200-ded4-11e9-8415-1d5778e14d3f.png)       
지금은 미국에 살고 있지만 저는 런던에서 태어났습니다.         
이 예시를 위해 작년 런던의 일별 기온을 가져왔습니다. 1월 1일의 기온은 화씨 40도였습니다.         
대부분의 나라는 섭씨 온도를 사용하지만 미국과 런던은 화씨 온도를 사용합니다.      
이것은 섭씨 4도와 같습니다. 1월 2일은 섭씨 9도네요 이런 식으로 1년의 절반인 181까지 나와 있습니다.          
180일에는 화씨 60도입니다. 섭씨 15도와 같습니다. 여름에는 따뜻해지고 겨울에는 더 춥습니다.       

# 데이터를 그려보기
![image](https://user-images.githubusercontent.com/50114210/65482507-4e52e800-ded4-11e9-8cfd-2f15923365bd.png)        
데이터를 그려보면 다음과 같습니다. 1월의 시작, 여름의 시작, 한 해의 끝은 여기쯤입니다.         
끝이 12월인 것입니다. 따라서 여기는 1월이고 여름의 중간은 여기고, 여기는 한 해의 끝입니다.            

# 지수가중평균
![image](https://user-images.githubusercontent.com/50114210/65482481-354a3700-ded4-11e9-8cc3-ecf99ee9fdc7.png)       
이 데이터는 약간의 노이즈가 있습니다. 여기서 지역 평균이나 이동 평균의 흐름을       
계산하고 싶다면 이런 방법이 있습니다. V_0를 0으로 초기화합시다.          
매일 이전 값에 0.9를 곱하고 여기에 0.1 곱하기 해당 날의 기온을 더해줄 것입니다.       
θ1은 첫 번째 날의 기온을 말합니다 둘째 날의 가중 평균 역시 이전 날의 값 곱하기 0.9에         
해당 날의 기온 곱하기 0.1을 한 값을 더해줍니다. 이런 식으로 계속 합니다.          
따라서 더 일반적인 식은 해당 날짜의 V_t는 이전 날짜의 V 곱하기 0.9 더하기      
해당 날짜의 기온 곱하기 0.1을 더한 값입니다. 

# 지수가중평균 그래프
![image](https://user-images.githubusercontent.com/50114210/65482522-5e6ac780-ded4-11e9-8096-193790e00c4f.png)      
따라서 이 값을 계산해 그림으로 나타내면        
이런 그림을 얻게 됩니다. 일별 기온의 지수가중평균을 얻게 됩니다.        

# 지수가중평균 공식
![image](https://user-images.githubusercontent.com/50114210/65482579-81957700-ded4-11e9-96f7-2fd7dc5697c3.png)        
이전 슬라이드의 공식을 다시 살펴봅시다. 이전에 쓰던 0.9를 β라고 표현하면        
V_t는 βV_t-1 더하기 0.1은 1-β로 표현한다면 더하기 (1-β)θt 가 됩니다.         
이전의 슬라이드에서 β는 0.9였습니다. 이유는 나중에 배울 것입니다만,         

# 평균과 근사한 지수가중평균
![image](https://user-images.githubusercontent.com/50114210/65482733-f8327480-ded4-11e9-9624-1134739a49e0.png)      
![image](https://user-images.githubusercontent.com/50114210/65482593-8f4afc80-ded4-11e9-8502-d7b92c812e0b.png)          
V_t를 계산한 값은 대략적으로 1/(1-β) 곱하기 일별 기온의 평균과 같습니다.         
예를 들어 β가 0.9와 같은 경우 이는 10일 동안 기온의 평균과 같습니다.           
그것이 이 붉은색 선입니다. 좀 다른 것을 시도해봅시다.         
β가 1과 매우 가까운 경우 예를 들어 0.98이면 1/(1-0.98)은 50과 비슷하므로
이 값은 50일의 기온의 평균과 거의 같습니다. 

# 베타가 커질 수록 영향받는 범위가 넓어진다.
![image](https://user-images.githubusercontent.com/50114210/65482650-b43f6f80-ded4-11e9-95c8-9a7edf5ca6fc.png)
이것을 그리면 초록색 선과 같습니다.            
여기서 알 수 있는 것은 β 값이 클수록 선이 더 부드러워집니다.          
더 많은 날짜의 기온의 평균을 이용하기 때문에 곡선이 더 부드러워집니다.         
그러나 곡선이 올바른 값에서 더 멀어집니다. 더 큰 범위에서 기온을 평균하기 때문이죠.              
그래서 기온이 바뀔 경우에 지수가중평균 공식은 더 느리게 적응합니다.          
따라서 지연되는 시간이 더 큽니다 β가 0.98이면 이전 값에 많은 가중치를 주고,        
현재의 기온에는 작은 가중치를 주게 됩니다. 따라서 기온이 올라가거나 내려가면,        
이 지수가중평균은 β가 커서 더 느리게 적응하게 됩니다.         

# 베타가 0.5일 때
![image](https://user-images.githubusercontent.com/50114210/65482690-d6d18880-ded4-11e9-850f-3b128e1f99f9.png)      
다른 값을 시도해봅시다. 또 다른 극단적인 예시로
β가 0.5라면 이 공식에 의해서 2일의 기온만 평균하는 것과 같습니다.            
그럼 다음과 같은 노란색 그래프를 얻게 됩니다.        
오직 2일의 기온만을 평균했기 때문에 더 노이즈가 많고 이상치에 더 민감합니다.          
그러나 기온 변화에 더 빠르게 적응합니다.          

# 지 
따라서 이 공식은 지수가중평균을 구현하기 위한 공식입니다.         
통계학 논문에서는 지수가중이동평균이라고 부릅니다.            
줄여서 지수가중평균이라고 부르겠습니다. 이 매개변수 혹은 학습 알고리즘의        
하이퍼파라미터의 값을 바꿈으로써 약간씩 다른 효과를 얻게 되고,         
이를 통해 가장 잘 작동하는 값을 찾게 됩니다. 빨간색 곡선을 주는 값을 말합니다.            
빨간색 곡선을 주는 값을 말합니다. 초록색이나 노란색 곡선보다는 더 나은 평균을 제공합니다.          
