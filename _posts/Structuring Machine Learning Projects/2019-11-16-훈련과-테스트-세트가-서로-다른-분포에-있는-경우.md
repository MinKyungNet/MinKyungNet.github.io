---
layout: post
title: "훈련과 테스트 세트가 서로 다른 분포에 있는 경우"
tags: [Train set, Dev set, Test set]
categories: [Structuring Machine Learning Projects]
---

# 학습 목표
학습과 시험 세트가 다른 분포상에 존재할 때의 해결방안을 탐구한다.

# 핵심 키워드
* 훈련 세트(train set)
* 개발 세트(dev set)
* 시험 세트(test set)

# 학습 내용
* 딥러닝은 학습 데이터가 많이 필요하기 때문에, 학습 세트와 개발 및 시험 세트의 분포가 달라지는 경우가 생길 수 있습니다. 분포가 서로 다른 데이터가 추가 되었을 대, 적용할 수 있는 두 가지 방법이 있습니다.
  - 새로 얻은 데이터를 기존의 데이터와 합쳐서 무작위로 섞어서 다시 학습, 개발, 시험 세트를 만드는 방법이 있습니다. 장점은 같은 분포에서 얻어졌기 때문에 다루기가 쉽지만, 큰 단점이 있습니다. 만약에 새로 얻어진 데이터에서 좋은 결과를 원한다면, 새로운 데이터의 비중이 월등히 적기 때문에, 원하는 성능을 얻기가 힘들어집니다.
  - 다른 방법으로 새로 얻어진 데이터의 일부를 훈련 세트로 섞은 다음, 개발 및 시험 세트는 모두 새로운 데이터로 만듭니다. 해당 방법은 새로 얻어진 데이터에서 좋은 결과를 얻는 목표에 도달 할 수 있습니다. 분포가 달라진다는 단점이 있지만, 장기적으로 더 나은 성능을 얻을 수 있습니다.

# 인트로
딥러닝 알고리즘은 훈련 데이터를 많이 필요로 합니다.          
라벨링된 훈련 데이터를 훈련 세트에 충분히 넣어준는 것으로도 잘 작동할 수 있으니까요.           
많은 팀들은 더 많은 훈련 데이터를 얻기 위하여 데이터를 찾는 족족 훈련 세트에 넣습니다.        
데이터 일부가 개발, 시험 세트와 같은 분포에서 얻어지지 않았는데도 말이죠.         
최근 딥러닝 분야에서는 더욱 많은 팀들이 개발, 시험 세트와 다른 분포에서 얻어진 데이터로 학습시키곤 합니다.         
이렇게 훈련 데이터와 개발, 시험 데이터가 서로 다른 경우를 다룰 때 약간의 미묘함이 있는데요.         
한번 살펴보도록 하겠습니다.       
 
# 고양이 분류기 예제
![image](https://user-images.githubusercontent.com/50114210/68987072-665a3e80-0869-11ea-80f2-e47f3be027d9.png)         
사용자가 이런 사진을 휴대폰으로 찍어서 사진을 업로드한다고 해봅시다.          
여러분은 모바일 앱으로 업로드된 사진이 고양이인지 아닌지 구분하고 싶습니다.            
이제 데이터가 두 군데에서 얻어지는 데요 오른쪽은 여러분이 신경쓰는 사용자가 모바일 앱에 업로드한 사진이고요.           
초보 사용자들이 찍었으니 덜 전문적인 사진이겠죠?           
또 초점도 안 맞아서 흐릿할 가능성이 높습니다.             
또 이 예시를 위해 웹을 샅샅이 뒤져서 다운로드한 사진을 사용할 수 있습니다.       
아주 전문적이고 높은 해상도의 고양이 사진이죠.         
여기서 모바일 앱의 사용자가 많지 않다고 해보겠습니다.            
10,000 장의 사진이 모바일 앱에서 업로드가 되었고요.          
하지만 웹을 샅샅이 뒤져서 다운로드한 결과 200,000 장의 사진을 인터넷에서 받았다고 합시다.          

# 개발과 테스트 세트를 어떻게 설정할 것이냐.
![image](https://user-images.githubusercontent.com/50114210/68987078-7bcf6880-0869-11ea-9b4e-1c5113f7eafe.png)          
여기서 신경이 쓰이는 부분은 여러분의 최종적인 시스템이       
모바일 앱에서 얻어진 사진에 대해서도 잘 적용될까 하는 겁니다.            
왜냐하면 결국 사용자들은 오른쪽과 같은 사진을 올릴테고              
그것에 대해 잘 작동하는 분류기를 만들어야하니까요. 하지만 딜레마에 빠졌습니다.            
왜냐하면 10,000 장의 사진이 이 분포에서 얻어졌고 더 많은 데이터가 다른 분포에서 얻어졌기 때문이죠.        
여러분이 원하는 것과 다른 모습의 사진들이죠.       
따라서 10,000 장의 상대적으로 적은 양의 사진을 훈련 세트로 사용하지 않고 200,000 장을 사용하는 것이 더 나아보입니다.        
여기서 딜레마는 여러분이 원하는 분포가 아니라는 것이죠.           

# 방법 1
![image](https://user-images.githubusercontent.com/50114210/68987094-99043700-0869-11ea-9b51-3a826ede5686.png)             
어떻게 해야 할까요? 여기 방법이 하나 있습니다.        
두 데이터를 합쳐서 210,000 사진을 무작위로 섞는 겁니다.            
그리고 훈련, 개발, 시험 세트를 만드는 거죠.            
여기에서 여러분의 시스템을 검증하기 위해 개발, 시험 세트를 각각 2,500장씩 둡시다.          
그러면 훈련 세트는 205,000장이 되겠죠. 이 방법은 장단점을 모두 갖고 있습니다.            
장점은 훈련, 개발, 시험 세트가 모두 같은 분포에서 얻어져서 다루기가 쉽다는 것입니다.          
반대로 단점은 아주 큰데요. 2500장의 개발 세트는 대부분 웹페이지 분포에서 얻어졌을 겁니다.           
여러분이 중요하게 여기는 모바일 앱 분포에서 얻어진게 아니라요.          
따라서 200,000장의 사진이 200K라고 줄여쓰겠습니다.          
210,000장, 즉 210K의 사진 중에서 웹페이지에서 얻은 것입니다.      
즉 이 2500개의 예시 중 아마 2381장의 사진이 웹페이지에서 얻어졌을 것입니다.            
이건 기댓값이기 때문에 정확한 값은 섞는 과정에 따라 다를 겁니다.            
하지만 평균적으로 119장의 사진만이 모바일 앱에서 얻어지는 것이죠.          
다시 말하지만 개발 세트는 팀이 어디를 목표로 하고 있는지           
나타내는데 이 상황에서는 대부분의 시간을 웹페이지에서 얻어진 사진에 대해 최적화하는데 쓰게 되는 거죠.        
이건 여러분이 원하는 결과가 아닙니다. 따라서 이 방법을 추천드리지 않습니다.           
팀이 중요하게 생각하는 목표와 다른 개발 세트에 대해 최적화를 하게 되기 때문이죠.           
이렇게 하는 대신 다른 방법을 쓰는 걸 추천합니다.           

# 방법 2
![image](https://user-images.githubusercontent.com/50114210/68987096-ad483400-0869-11ea-8017-323758321fe8.png)       
훈련 세트가 여전히 205,000장의 사진이라고 합시다.       
훈련 세트에 웹페이지에서 얻은 200,000장의 사진 모두와           
원한다면 모바일 앱에서 얻은 5,000장의 사진을 추가하는 거죠.                    
그러면 개발, 시험 세트는 모두 모바일 앱에서 얻어진 사진을 사용하는 것이죠.         
즉 훈련 세트는 웹에서 구한 200,000장의 사진과 모바일 앱에서 구한 5,000장의 사진을 포함하고            
개발 세트는 모바일 앱에서 구한 2,500장의 사진 시험 세트도 마찬가지로            
모바일 앱에서 구한 2,500장의 사진을 쓰는 겁니다.         
이렇게 훈련, 개발, 시험 세트를 나누는 방법의 장점은         
여러분이 실제로 원하는 것을 목표로 삼는다는 것입니다.       
즉 여러분이 속한 팀의 개발 세트가 모바일 앱에서 업로드된 데이터를 사용하고             
그건 여러분이 중요하게 생각하는 사진의 분포라는 것이죠.       
그래서 여러분은 모바일 앱 분포의 사진에서 잘 작동하는 앱을 만들었다고 할 수 있는 겁니다.             
이 방법의 단점은 훈련 세트의 분포가 개발, 시험 세트의 분포와 다르다는 것입니다.        
하지만 이렇게 훈련, 개발, 시험 세트를 나누면 장기적으로는 더 나은 성능을 달성할 수 있을 겁니다.         

# 백미러 예제
![image](https://user-images.githubusercontent.com/50114210/68987104-bc2ee680-0869-11ea-8562-60eefb3dd19b.png)         
다른 예시도 하나 살펴볼까요? 차에다가 말로 활성화시키는 백미러를 여러분이 만든다고 합시다.            
중국에서 실제 존재하는 상품이고 수출을 준비하고 있는 것 같더군요. 이것을 대체할 백미러를 만드는 겁니다.           
그래서 백미러에게 백미러야, 가까운 주유소를 찾아줘와 같이 말하는 겁니다.          
그러면 백미러가 찾아주는 거죠. 실제 상품입니다.     
대신 여러분의 나라에 팔기 위한 상품을 만든다고 합시다.             

# 백미러 예제의 데이터 구성
![image](https://user-images.githubusercontent.com/50114210/68987111-ce108980-0869-11ea-9c16-5940952abe3b.png)           
그러면 이 상품의 음성 인식에 학습시킬 데이터를 어떻게 구할 수 있을까요?           
만약 음성 인식 분야를 오랫동안 연구했다면 다른 음성인식 애플리케이션의 데이터를 많이 갖고 계실 겁니다.           
음성 활성화 백미러말고도 말이죠. 이제 훈련 세트와 개발, 시험 세트를 나눠봅시다.            
훈련을 위해서는 다른 음성 인식 문제에서 사용했던 데이터들을 사용할 수 있습니다.       
음성 데이터 회사에서 몇 년 동안 구매한 데이터 등이 있겠죠?        
요즘은 이런 회사에서 X Y 쌍의 데이터를 구매할 수 있습니다. X는 음성이고 Y는 대본이죠.             
또 음성으로 활성화하는 스마트 스피커를 다뤘다면 그 데이터를 사용할 수도 있겠죠.           
또는 음성 활성화 키보드도 있을 수도 있겠죠. 편의를 위해 500,000개의 음성 데이터가 있다고 합시다.          
이 모든 곳에서 얻어진 데이터들이죠.         
그리고 개발, 시험 세트는 훨씬 작은 대신 음성 활성화 백미러에서 얻어졌을 겁니다.            
왜냐하면 사용자들이 방향을 물어보거나 목적지로 가기 위한 방법을 확인한다면         
데이터는 주소 등의 데이터를 많이 포함하고 있을테니까요.       
이 거리의 끝으로 가 달라 이 주유소로 가 달라는 것처럼 말입니다.            
즉 왼쪽의 데이터와 전혀 다른 분포의 데이터인 것입니다.             
하지만 이 데이터가 여러분이 중요하게 생각하는 데이터지요.         
여러분의 상품이 이 데이터에 대해서 좋은 성능을 보여야 하니까요.           
따라서 이 데이터들로 개발, 시험세트를 구성하는 겁니다.          
즉 이 예시에서는 훈련 세트를 왼쪽 500,000개의 음성 데이터로 구성하고       
개발, 시험 세트, 줄여서 D와 T라고 할게요.         
실제 음성 활성화 백미러에서 얻어진 10,000개의 음성 데이터가 되겠지요.       
또는 음성 활성화 백미러에서 얻어진 20,000개의 예시를          
모두 개발, 시험 세트로 사용하는 대신 절반은 훈련 세트에 넣을 수도 있습니다.       
그러면 훈련 세트는 510,000개의 음성 데이터로 구성되겠죠?           
500,000개는 왼쪽에서 10,000개는 백미러에서 얻어졌습니다.       
그리고 개발, 시험 세트는 각각 5,000개의 음성 데이터로 구성되는 것이죠.      
즉 20,000개의 음성 데이터 중 10,000개는 훈련 세트, 5,000개는 개발 세트          
5,000개는 시험 세트로 사용되는 겁니다.            
이것 역시 데이터를 훈련, 개발, 시험 세트로 나누는 합리적인 방법입니다.       
이 경우 백미러에서 얻어진 데이터를 모두 개발, 시험 세트로 사용한 경우보다 훈련 세트의 크기가 훨씬 커지죠.        

# 아웃트로
이 영상에서는 훈련 세트의 데이터가 개발, 시험 세트와 다른 분포에서 얻어졌을 때 예시를 두 가지 살펴봤습니다.        
훨씬 큰 훈련 세트를 얻을 수도 있었죠? 그리고 학습 알고리즘의 성능 또한 나아질 겁니다.        
