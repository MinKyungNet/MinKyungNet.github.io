---
layout: post
title: "오차 분석하기"
tags: [error analysis]
categories: [Structuring Machine Learning Projects]
---

# 학습 목표
오차분석하는 방법을 배운다.

# 핵심 키워드
오차 분석(error analysis)

# 학습 내용
* 오차 분석을 통해 알고리즘이 범하고 있는 실수를 직접 파악하여 오차를 줄이는 것에 대한 비용을 알아볼 수 있습니다. 또한, 이 과정에서 새로운 오류가 어떤 것들이 있는지 알 수 있습니다.
* 기계가 잘못 분류한 예시들에서 비중을 가장 많이 차지하는 부분을 찾아서 해당 오류를 고치는 것이 가장 효율이 높습니다.

# 인트로
여러분의 학습 알고리즘이 사람이 할 수 있는 일을 하기를 원한다면         
그러나 학습 알고리즘의 성능이 사람의 수준에 미치지 못 한다면           
알고리즘이 범하고 있는 실수를 직접 파악하는 것으로써 앞으로 무얼 해야하는지 직관을 줄 수 있습니다.            
이걸 오차 분석이라고 하는데요. 예시를 통해 살펴보도록 합시다.           

# 개와 고양이를 헷갈림
![image](https://user-images.githubusercontent.com/50114210/68947519-00ce6980-07f9-11ea-84e5-f3d883ac508f.png)      
고양이 분류기를 다루고 있고 90%의 정확도를 달성했다고 합시다.          
즉 개발 세트에 대해 10%의 오차를 보인 거죠.           
여러분이 기대한 것에 훨씬 덜 미치는 수준이라고 해보죠.       
알고리즘이 잘못 분류한 예시들을 동료가 본 뒤에            
몇 종류의 개를 고양이로 잘못 분류한 것을 알아챘습니다.             
여러분이 생각하기에도 한 눈에 보면 고양이와 얼추 비슷해보이는군요.          

# 이런 상황에서 개 문제를 다뤄야할까?
그래서 동료는 개에 대해 더 좋은 성능을 내는 알고리즘을 만들어보라고 제안합니다.             
여러분이 중점을 두기 위해서는 더 많은 개 사진을 모으거나 개에만 특정된 특징을 필터링할 수 있겠죠.             
이로써 개에 대해 여러분의 고양이 분류기가 더 좋은 성능을 내고        
따라서 개를 고양이로 잘못 인지하는 일을 멈출 겁니다.            
여기서 질문은 개 문제에 초점을 맞춘 프로젝트를 과연 진행해야 하느냐는 겁니다.            
개 그림에 대한 실수를 줄이기 위해서는 몇 달 간 일해야 할 수도 있습니다.           
정말 가치 있는 노력일까요?           

# 오차 분석법
![image](https://user-images.githubusercontent.com/50114210/68947546-1ba0de00-07f9-11ea-8b3e-88c4034e8fd9.png)           
특정한 지점에 도사리고 있는 위험을 해결하기 위해 몇 달을 쓰는 것보다,                      
오차 분석 과정을 통해 이 노력이 가치있는 것인지 빨리 파악할 수 있습니다.           
우선 100개 가량의 잘못 라벨링된 개발 세트의 예시들을 모아 과연 몇 개가 실제 개 사진인지를 일일이 셉니다.            
5%의 잘못 라벨링된 사진이 개의 사진이었다고 해보죠.         
즉 100개의 잘못 라벨링된 예시 중에 5개의 사진이 개인 겁니다.           
즉 개 문제를 해결하더라도 전형적인 100개의 잘못 라벨링된 그림 중 5개만 정답으로 바뀌는 거죠.                
만약 5%의 그림이 검정색 사진이었다면 여러분이 검정색 사진 문제를 해결하기 위해            
많은 시간을 들였을 때 여러분은 오차가 10%에서 9.5% 줄어들기를 바라는 것이 합라적입니다.           
즉 오차에 대해서 5%만큼 감소하여 10%에서 9.5%로 바뀌는 것이죠.          
즉 가장 효율적으로 시간을 쓰는 것이 아니라고 결론 내릴 수 있습니다.           
개 문제를 다룸으로써 여러분이 얼마나 성능을 높일 수 있는지 그 상한을 알 수 있습니다.           
머신러닝에서 이걸 천장이라고 부르는데요. 최고로 좋은 경우를 일컫죠.           
즉 개 문제가 문제 해결에 얼마나 도움이 될 지 알 수 있습니다.           

# 50%가 잘못 라벨링 되어있었다면?
![image](https://user-images.githubusercontent.com/50114210/68947584-37a47f80-07f9-11ea-9337-4b562376668c.png)         
이제 다른 상황을 가정해봅시다. 100개의 잘못 라벨링된 그림 중에 50개가 개의 사진이었습니다.            
50%가 개의 사진이었던거죠 이제 개 문제에 시간을 들이는 것에 더욱 낙관적일 수 있습니다.          
이 경우 개 문제를 해결한다면 오차는 10%에서 5%까지 줄어들 수 있을테니까요.            
그러면 잘못 라벨링된 개 문제를 해결하는게 오차를 절반으로 줄이니            
그만한 가치가 있다고 결정을 내릴 수 있는 거죠.          
머신러닝은 때때로 직접 손으로 하거나 직관을 너무 많이 쓰는 걸 하찮게 볼 때가 있습니다.             
하지만 실제 응용 시스템을 만들면 이렇게 간단히 세는 것, 즉 오차 분석으로 무엇이 가장 중요한 일인지         
다음에 무엇을 초점을 둬야할지 결정할 때 큰 시간을 줄일 수 있습니다.            
만약 100개의 잘못 라벨링된 예시를 본다 치면            
100개의 예시를 훑고 개인지 결정하는데 5~10분의 시간이 필요할 겁니다.                
그리고 5%인지 50%인지 아니면 다른 값인지 그 결과에 따라 5~10분의 노력을 통해            
지금 가는 방향이 맞는 것인지를 가늠할 수 있고 몇 달을 쓰지 않고도 더 나은 방향을 설정할 수 있게 됩니다.            
잘못 라벨링된 개 문제를 풀지 않고도 말입니다.           

# 한번에 여러개를 오차 분석하기
![image](https://user-images.githubusercontent.com/50114210/68947639-5571e480-07f9-11ea-9c96-d3b5fa68773f.png)       
하지만 때때로 오차 분석을 통해 여러 개의 아이디어를 한꺼번에 평가하고 싶을 수도 있습니다.            
예를 들어 고양이 감지기를 향상시키기 위해 다양한 아이디어가 있다고 합시다.        
개에 대하여 성능을 향상시킬 수도 있겠고 또는 사자, 검은 표범, 치타처럼                 
고양이와 비슷하게 생긴 큰 동물들이 작은 고양이로 분류되는 것을 다룰 수도 있을 겁니다.            
또는 몇몇 사진이 흐려서 흐린 사진에 대해서 더 잘 작동하는 시스템을 생각해볼 수도 있겠죠.         
그것의 구현과 관련된 아이디어도 몇 가지 있을 겁니다.          
이 아이디어들을 평가하기 위해 오차분석을 사용해보겠습니다.           
이런 표를 하나 그리고요. 주로 엑셀을 사용하는데요.             
일반적인 텍스트 파일을 사용해도 됩니다. 왼쪽에는 여러분이 직접 살펴보실 사진들이 적혀 있습니다.          
만약 100개의 사진을 본다면 1에서 100까지 적혀 있겠죠?           
그리고 이 표 또는 엑셀의 첫 열에는 평가하기 위한 아이디어를 적습니다.           
개, 큰 고양이류 동물, 흐린 사진이죠. 그리고 메모를 할만한 곳을 오른쪽에 남겨 놓습니다.         
오차 분석 중에는 개발 세트의 예시 중 알고리즘이 잘못 인지한 걸 살펴봅니다.          
만약 첫번째로 잘못 분류된 사진이 개였다면 체크를 하고요.        
그리고 따로 사진을 기억해두기 위해서 핏불처럼 여기에 메모를 써넣는 거죠.           
만약 두번째 사진이 흐렸다면 체크를 하고         
세번째 잘못 분류된 사진이 비 오는 날 동물원에 있는 사자라면            
흐린 것과 동시에 큰 고양이류의 동물이니 이렇게 체크합니다.          
그리고 메모를 이렇게 하는 거죠. 비오는 날의 동물원에서 비가 사진을 흐리게 만듦 이라고요.          

# 각 오류의 비율 체크하기
![image](https://user-images.githubusercontent.com/50114210/68947681-6a4e7800-07f9-11ea-9f1f-adbd96d7584d.png)        
이렇게 사진들을 일일이 센 뒤에는 각 카테고리가 몇 퍼센트인지를 헤아립니다.          
개, 큰 고양이 류, 흐린 사진 각각에 해당하는 비율을요.          
여기서는 살펴본 사진 중의 8%가 개였고 43%는 큰 고양이류의 동물 61%는 흐린 사진이었다고 합시다.         
각 열에 체크 표시가 몇 개 되어 있는지를 비율로 환산한 것에 불과합니다.          
이 과정을 거치면서 가끔 다른 종류의 실수를 파악할 수도 있겠죠.           
화려한 인스타그램 스타일의 필터가 씌여져서 분류기가 잘못 작동했을 수도 있겠죠.             
이처럼 과정 중에 발견한 경우 화려한 인스타그램, 스냅챗 필터에 대한 열 하나를 더 추가해도 무방합니다.            
그리고 다시 세는 거죠. 새로운 종류의 비율도 계산하고요.               

# 어떤 문제를 다뤄야할지 직관을 주는 오차 
이 과정을 통해서 여러분은 각 오차 종류를 다루는 것이 얼마나 효율적인지 추정해볼 수 있습니다.         
예를 들어 이 예시에서  흐릿한 사진에 대한 오류가 많이 있고요.          
또 큰 고양이류의 동물에 대해서도 꽤 많은 오류가 일어났습니다.         
이 분석의 결론은 흐린 사진을 다뤄야 한다는 것이 아닙니다.            
여러분이 뭐해야 할지를 결정해주는 딱딱한 수학 공식이 아니에요.             
여러분이 시도할만한 최고의 선택지가 무엇인지 느낌을 주는 것이죠.          
그리고 이 예시에서는 개나 인스타그램 사진을 얼마나 잘 다루든지             
최대 8% 또는 12%의 향상만 얻을 수 있다는 것도 알 수 있습니다.            
반면에 큰 고양이류의 동물이나 흐린 사진의 경우에는          
천장, 즉 얼마나 향상시킬 수 있느냐 하는 것은 훨씬 큽니다.            
큰 고양이류의 동물, 흐린 사진에 관한 성능을 향상시키기 위한 아이디어의 수에 따라           
둘 중 하나를 선택할 수도 있고 팀의 인원이 충분하다면 두 개의 팀을 만들어서       
한 팀은 큰 고양이류의 동물로 인한 오차를 다루고           
다른 팀은 흐린 사진 때문에 발생한 오차를 다루게 할 수도 있습니다.            
많아야 몇 시간 안에 끝낼 수 있는 이 헤아리기 과정을 통해서                 
무엇을 먼저 해야할지 결정을 내리고 각 접근이 가져올 다른 결과에 대해 이해할 수 있습니다.   

# 아웃트로
요약하자면 오차 분석을 이용하기 위해서는 개발 세트에서 잘못 분류된 예시들을 찾은 뒤            
거짓 양성 및 거짓 음성의 잘못 라벨링된 예시들을 살펴봅니다.             
그리고 다양한 카테고리에 속하는 오류의 숫자를 세는 것입니다.          
이 과정을 통해 새로운 종류의 오차를 발견할 수도 있습니다.           
예시를 살펴봤던 것처럼 인스타그램 사진, 스냅챗 필터가 분류기에서 잘못 분류되고 있었습니다.          
이렇게 새로운 종류를 생각해낼 수도 있고요.           
또한 잘못 라벨링된 예시들의 비율을 계산하면서 새로운 방향을 정하거나          
해야할 일의 우선 순위를 정할 수 있습니다
