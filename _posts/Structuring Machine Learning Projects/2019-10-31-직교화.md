---
layout: post
title: "직교화"
tags: [Orthogonalization]
categories: [Structuring Machine Learning Projects]
---

# 학습 목표
직교화에 대해 학습한다.

# 핵심 키워드
직교화(Orthogonalization)

# 학습 내용
* 머신러닝 전략에서 말하는 직교화는 원하는 효과를 위해 변수를 조정하는 과정입니다.
* 직교화가 무엇인지 대략적인 감을 짚고 넘어갑니다.
* 머신러닝에서는 아래 네 가지 과정을 거쳐야합니다.
  - 학습 세트에 대해서 좋은 성능이 나와야 합니다. 어플리케이션에 따라서 사람 레벨의 퍼포먼스만큼 나와야 할 수도 있습니다.
  - 개발 세트에 대해서 좋은 성능을 보여야합니다.
  - 시험 성능에 대해서 좋은 성능을 보여야합니다.
  - 마지막으로 실제 세상에서도 좋은 성과로 이어져야합니다.
* 하지만 모든 과정이 원활하지 않을 수도 있습니다. 따라서 네 가지 과정중에 문제가 생긴 부분을 파악하고 그 부분을 조정할 수 있습니다.
  - 학습 세트에서 성능이 떨어진다면 신경망 네트워크를 조정하거나, 학습 알고리즘을 바꿔봅니다.
  - 개발 세트에서 성능이 떨어진다면 정규화나 더 큰 학습 세트를 사용해봅니다.
  - 시험 세트에서 성능이 떨어진다면 더 큰 개발 세트를 사용해봅니다.
  - 실제 세상에서 원하던 성능이 안 나온다면, 개발세트 혹은 비용함수를 바꿔봅니다. 왜냐면 개발 세트의 분포가 잘못 설정 되었거나, 비용함수가 무언가 잘못 측정하고 있기 때문입니다.

# 인트로
머신러닝 시스템을 만들 때 어려운 이유 중 하나는 시도하거나 바꿀 것이 아주 많기 때문이죠.          
예컨대 조정할 하이퍼파라미터도 적지 않으니까요.         
제가 말씀드렸던 것처럼 머신러닝 분야의 사람들이 가장 잘 하는 것이               
원하는 효과를 내기 위해 뭘 조정해야 할지 안다는 겁니다. 이 과정을 직교화라고 합니다.         
제가 뭘 말하고 있는지 지금부터 설명해드리죠.         

# 직교화
여기 오래된 학교의 TV가 있습니다.            
다양한 방법으로 화면을 조정할 수 있도록 여러 버튼이 있군요.                  
이 오래된 TV의 설정에는 이미지의 높이를 조정하는 버튼이나              
이미지의 너비를 조정하는 버튼, 사다리꼴처럼 사진을 조정하는 버튼                 
또 다른 버튼은 왼쪽이나 오른쪽으로 사진을 옮길 수도 있겠죠.     
그리고 사진을 회전시킬 수도 있을 겁니다.             
당시 TV 디자이너들은 각 버튼이 특정 기능을 수행할 수 있도록         
아날로그 회로를 만드는 데 많은 시간을 썼을 겁니다.              

# 안 직교화 예제 1
반대로 한 버튼이 0.1배의 이미지 높이 0.3배의 이미지 너비              
-1.7배의 사다리꼴에 가까운 정도 0.8배의 이미지 수평 위치 등을 조정한다고 합시다.   
이렇게 높이, 너비, 사다리꼴에 가까운 정도 위치 등이 한번에 조정되는 것이죠.          
이런 버튼을 쓴다면 사진이 중앙에 오도록 TV를 설정할 수 없을 겁니다.          
이런 맥락에서 직교화는 TV 디자이너가 버튼이 하나의 기능만 맡도록 만드는 것을 말합니다.           
따라서 TV를 더욱 손쉽게 설정할 수 있죠. 원할 때 그림을 중앙에 놓기도 쉽고요.      

# 안 직교화 예제 2
직교화의 또다른 예시를 살펴봅시다.         
여러분이 운전을 배운다고 할 때 크게 세 가지 조작을 할 수 있겠죠?          
핸들을 돌려서 왼쪽이나 오른쪽으로 얼마나 틀지 그리고 가속의 정도와 브레이크를 얼마나 밟을지요.            
이 세 가지 조작 중 하나는 핸들이 하고 속도에 관한 다른 두 가지 조작 역시               
여러분의 행동이 차에 어떻게 영향을 미칠지 알아채기 쉽습니다.     
그런데 어떤 사람이 차를 디자인해서 스틱을 한 쪽으로 움직이면 0.3배의 회전각과 -0.8배의 속도를             
다른 조작을 하면 2배의 회전각과 0.9배의 속도를 조정할 수 있다고 합시다.            
이론적으로는 이 두 조작을 통해 차를 원하는 방향과 속도로 운전할 수 있습니다.         
하지만 회전각과 속도를 조절하는 기능이 다 따로 있을 때보다 훨씬 다루기 어렵지요.           

# 직교화의 시각화
여기에서 직교화의 개념을 설명하자면 회전각을 조정하는 것을                
하나의 차원으로 생각하고 다른 차원을 속도 조절으로 생각한다면 하나의 버튼은 회전각만 영향을 주고            
다른 버튼은 가속 페달이나 브레이크를 통해 속도를 조정할 수 있게 만드는 것과 같습니다.           
여기 회전각과 속도가 같이 조절되는 것처럼 두 가지가 동시에 바뀐다면          
여러분이 원하는 속도와 회전각으로 설정하기 어려울 겁니다.            
직교는 여기에서 서로 90도를 이룬다는 뜻인데요.              
직교 조작을 한다는 것은 곧 여러분이 쉽게 버튼을 조작해서         
원하는 속도나 회전각 대로 차를 움직이게 하는 것을 말합니다.          

# 머신러닝에서의 직교화
이게 머신러닝과 어떤 연관이 있을까요?         
지도 학습이 잘 되기 위해서는 시스템의 버튼을 잘 조정해서 이 네 가지를 만족해야 합니다.      


첫째는 적어도 학습 세트에 대해서는 좋은 성능을 보여야 한다는 겁니다.         
학습 세트에 대한 성능이 받아들일만한 수준이여야 하죠.         
어떤 애플리케이션에서는 사람 수준의 성능과 유사할 수도 있고요.        
물론 애플리케이션에 따라 차이가 있습니다.          
학습 세트에 대해 좋은 성능을 보인 뒤에는 개발 세트에서도 좋은 성능을 보이길 원하겠죠?        
그리고 시험 세트에 대해서도요.          
끝으로 시험 세트에 대해 비용 함수가 좋은 성능을 보이는 것이       
실제 세상에서도 좋은 성과로 이어지길 바랄 겁니다.           
예컨대 고양이 사진 애플리케이션의 사용자가 만족할 수 있는 것이죠.      


TV를 설정하는 예시로 돌아가보면요.        
TV 안의 사진이 너무 넓거나 좁을 때 하나의 버튼을 사용해서 그걸 조정하길 원할 겁니다.          
다른 것에도 영향을 줄 수 있는 다섯 개의 버튼을 조심스레 조정하긴 싫잖아요?         
즉 사진의 너비와 관련된 하나의 버튼만 조작하는 것이지요.       

### 학습 세트에서 문제
비슷한 측면에서 알고리즘이 비용 함수에 대해 학습 세트와 잘 맞지 않다면 여기 그리는 건 버튼입니다.          
어떤 버튼들을 이용해서 알고리즘이 학습 세트에 대해 잘 작동하도록 조정할 수 있겠죠.        
여러분이 이걸 조정할 때 쓰는 버튼으로는 더 큰 신경망을 이용한다든가      
Adam처럼 더 나은 최적화 알고리즘을 쓰는 것이 될 수 있겠습니다.        
이 주와 다음 주에 또다른 선택지를 살펴볼 겁니다.         

### 개발 세트에서 문제
반대로 만약 알고리즘이 개발 세트에 잘 맞지 않는다면 또 다른 버튼들이 있습니다.          
다른 버튼들을 쓰는 것이 아니고요. 독립된 버튼을 원할 테니까요.          
예컨대 알고리즘이 개발 세트에 대해 잘 작동하지 않는다면      
학습 세트에서는 잘 작동하지만 말이죠.         
정규화에 관련된 버튼을 이용해서 두번째 기준을 충족할 수 있을 겁니다.         
비유를 하자면 여러분이 TV 사진의 너비를 설정했는데 사진의 높이가 마음에 들지 않는다면         
다른 버튼을 이용해서 높이를 조정하는 것과 비슷합니다.          
이때는 TV 사진의 너비가 너무 많이 영향을 받으면 안 되겠죠.         
더 큰 학습 세트를 쓰는 것도 방법이 될 수 있습니다.        
이로써 학습 알고리즘이 일반화되서 개발 세트에 적합해질 수도 있죠.        

# 시험 세트에서 문제
이제 TV 사진의 높이와 너비를 맞췄다고 합시다.      
그럼에도 불구하고 세 번째 조건을 만족하지 못 한다면 어떨까요?         
개발 세트에 대해서는 좋은 성능을 보이지만 시험 세트에 대해서는 그렇지 않은 겁니다.          
이런 경우에는 큰 개발 세트를 갖도록 버튼을 조정할 수 있을 겁니다.                  
왜냐하면 개발 세트에서는 잘 작동하지만 시험 세트에 대해서는 그렇지 않은 경우                    
아마 개발 세트에 대해 과잉 조정된 것일테니 다시 돌아가서 더 큰 개발 세트를 찾아야 합니다.             

# 현실에서 문제
끝으로 시험 세트에 대해서는 잘 작동하지만 고양이 사진 애플리케이션의 사용자가         
만족하지 않을 경우 돌아가서 개발 세트나 비용 함수를 바꿔야 합니다.          
왜냐하면 어떤 비용 함수에 대해 시험 세트에서 잘 작동하는 것이         
알고리즘이 실제 세상에서 잘 작동하는 것과 일치하지 않는다는 건         
개발 세트의 분포가 잘못 설정되었거나 비용 함수가 뭔가를 잘못 측정하고 있다는 것입니다.           

# 조기 종료
제가 신경망을 학습시킬 때는 조기 종료를 잘 사용하지 않습니다.            
많은 사람들이 쓰는 만큼 기술이 나쁘다는 건 아닙니다.             
하지만 개인적으로 조기 종료를 쓰면 생각하기가 힘들더라고요.         
만약에 조기 종료를 하면 학습 세트에 대해서 잘 맞아야하니까요.         
이 버튼을 조정할 텐데 이 버튼은 학습 세트뿐만 아니라 개발 세트에 관한 성능도 개선시킵니다.       
즉 덜 직교화되어 있는 것이지요.         
TV 사진의 높이와 너비를 동시에 조정하는 버튼과 비슷한 겁니다.         
나쁘다는 것은 아닙니다. 원한다면 사용하셔도 좋아요.         
하지만 제가 여기 적은 것처럼 우리에게는 더 잘 직교화된 선택지가 있습니다.           
그러면 신경망을 조정하기가 한결 수월하죠.             

# 아웃트로
이렇게 직교화에 대한 감을 잡으셨으면 좋겠습니다.          
우리가 봤던 TV 사진 예시에서처럼 TV 사진이 너무 넓다면 이 버튼을 조정하고            
너무 높다면 이 버튼을 조정하고 너무 사다리꼴처럼 생겼다면 저 버튼을 조정하는 방식이 좋다는 것이죠.                 
머신러닝 시스템에서는 학습 세트, 개발 세트, 시험 세트나        
시험 세트에서 잘 되지만 실제 세상에서는 잘 적용되지 않는 등 문제가 발생하면     
무엇이 문제인지 정확히 밝혀낸 다음 정확히 하나나 특정 버튼들을 이용해서     
머신러닝 시스템의 성능을 제한시키는 문제를 풀 수 있을 겁니다.        

