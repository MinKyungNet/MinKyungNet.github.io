---
layout: post
title: "7강 도박꾼의 파산 문제와 확률변수"
tags: [도박꾼의 파산, 계차 방정식, 확률 변수, 확률 분포, 확률 질량 함수, 베르누이 분포, 베르누이 시행, 이항 분포]
categories: [Statistics 110]
---

# 학습 목표
Gambler's Ruin문제를 계차방정식을 이용해 풀고, 확률변수의 정의를 이해할 수 있다.

# 핵심 키워드
- 도박꾼의 파산
- 계차 방정식
- 확률 변수
- 확률 분포
- 확률 질량 함수
- 베르누이분포, 베르누이 시행
- 이항 분포

# 학습 내용
### 도박꾼의 파산     
A와 B 두명의 도박꾼이 매 라운드 1달러씩 걸고 도박을 한다.       
이긴 사람은 상대방의 1달러를 가지고,        
둘 중 한명이 가지고 온 돈이 바닥날 때까지 이 과정을 반복한다.       
p = P(A가 어떤 라운드를 이긴다.)
q = 1-p      
A는 i달러, B는 N-i달러를 가지고 게임한다고 할 때,       
![image](https://user-images.githubusercontent.com/50114210/72661406-e4c78e00-3a1c-11ea-8263-674d2b389fba.png)     
p의 확률로 A가 1달러를 더 얻고, q의 확률로 1달러를 잃는다.    
0, N은 흡수상태라 하여, 게임의 종료를 나타낸다.      

pi : A가 i 달러로 시작하여 게임을 이길 확률    
pi = p x p(i+1) + q x p(i-1), (1 <= i <= N-1), p0 = 0, pN = 1       
이를 계차방정식이라고 한다. (미분 방정식의 이산 형태)      

### 추측을 통한 풀이       
![image](https://user-images.githubusercontent.com/50114210/72661414-248e7580-3a1d-11ea-9e46-3efe368df318.png)      

### 해석
![image](https://user-images.githubusercontent.com/50114210/72661425-38d27280-3a1d-11ea-8ed6-a658b12118e4.png)     
하우스와 같은 돈을 가지고 시작하고, 1% 정도로만 불공평한 게임이라고 해도 게임을 계속하다 보면 이길 확률이 매우 적어지게 됟나.      

### 확인할 점    
게임이 끝나지 않고 영원히 계속될 확률이 있는가?     
게임이 공평한 상황에서 (p = q) B가 (N-1달러를 갖고)이길 확률은 (N-1)/N이다.     
i/N + (N-i)/N = 1 이므로 게임이 계속될 확률은 0이다.   

### 확률 변수 
표본공간 S부터 실수 체계 R로 매핑하는 함수    
![image](https://user-images.githubusercontent.com/50114210/72661445-7d5e0e00-3a1d-11ea-8ce1-5a59a06789ff.png)         

### 예시) 베르누이 확률 변수
X가 0, 1 두가지의 값만 가질 수 있으며,    
P(x=1) = p, P(x=0) = 1-p일 때,    
X는 Bernoulli(p)분포를 따른다고 한다.     

### 예시) 이항 확률 변수   
n번의 독립적인 베르누이(p)시행에서 성공 횟수의 분포는 Bin(n, p)를 따른다고 한다.     
이항 확률 변수의 확률질량 변수(PMF) : P(X = k) = nCk x p^k x (1-p)^n-k       
이항 확률 변수의 특징:     
X ~ Bin(n, p), Y ~ Bin(m, p)일 때,        
X + Y ~ Bin(n + m, p)를 따른다.        

이 강의에서 가장 중요한 것은 조건과 확률과 확률 분포     
이 강의에서 하는 것은 여러한 것에 조건을 다는 것     
그리고 확률 변수와 그에대한 분포     

# 도박꾼 파산 문제     
![image](https://user-images.githubusercontent.com/50114210/72660335-ceff9c00-3a0f-11ea-91da-97b1dbbd42cf.png)     

도박꾼 A와 도박꾼 b가 있다.    
서로 1달러씩 걸고 같은 게임을 반복하고 있다.     
한 명은 1달러를 따고 다른 한명은 1달러를 잃는다.    
둘 중 한명이 파산하면 게임이 끝나는데     
게임이 끝나는지 어떻게 알 수 있을까?    
도박꾼 A, B가 있고 라운드를 반복한다.      
게임은 과정 전체고 라운드는 도박 한 번이다.     
한 라운드는 독립이고    
p : A가 한 라운드를 이길 확률        
q : B가 한 라운드를 이길 확률       

### A가 이길 확률을 구해보자. 
A가 돈을 모두 따고 B가 파산하는 경우를 계산해보자.   
A가 파산하는 경우도 알아보자.    
초기 조건을 가정하자.  
A는 i달러를 가지고 시작한다고 가정하자.    
B는 N-i달러를 가지고 시작한다고 가정하자.    
이렇게 쓴 이유는 i가 정수를 뜻하고 저웃의 달러가 이동하기 때문입니다.   
B는 N-i달러로 시작하면 총 N달러가 있다.    
외부에서 들어오거나 나가는 돈은 없다.    
N달러의 돈이 왔다갔다하면서 한 도박꾼이 N달러를 가지면 게임이 끝난다.    

### 이 예제가 중요한 이유
1. 도박뿐만 아니라 성공 확률과 실패 확률이 정해져 있는 독립적인 사건을 반복하는 자연스런 문제이기 때문   
![image](https://user-images.githubusercontent.com/50114210/72660348-f191b500-3a0f-11ea-818f-4b6ef26f50cd.png)    
이 문제와 정확히 같은 문제로 수직선을 생각해볼 수 있다.      
0과 N이 있고 중간에 i가 있을 때   
i는 0과 N사이 아무데나 있을 수 있다.        
i는 시작점이고 무작위행보는 i에 뭔가 있다고 생각하고 한 걸음 움직이는 문제       
오른쪽으로 갈 확률은 p이고 왼쪽으로 갈 확률은 q이다.       
i+1로 가면 다시 i로 돌아오거나 i+2로갈 수도 있다.       
이 문제는 오른쪽을 움직일 확률이 p인 문제이다.     
이 입자가 0이나 N에 도착하면 게임이 끝나게 되는 것     
이는 흡수 상태라고 부르고 0과 N이 있다.    
A가 가진 돈을 표현하는 무작위 행보라고 생각할 수 있다.   

### 문제 풀이         
처음엔 쉽지 않아 보일 수 있다.        
게임이 몇라운드 동안 진행될지도 모르고 영원히 반복될 수도 있다.    
게임이 끝나지 않는 확률은 0인데 이를 어떻게 알 수 있을까?    
이 문제는 재귀적인 형태를 가지고 있다.    
A가 첫 라운드를 이기거나 지는 두가지 경우가 있다.   
A가이기면 오른쪽으로 움직이고 다시 똑같은 문제가 된다.    
A가 첫 라운드에서 지게 된다면 i-1에서 시작하는 똑같은 문제가 된다.    

![image](https://user-images.githubusercontent.com/50114210/72660419-fc007e80-3a10-11ea-82aa-c86ad01f6a4b.png)     

일반적인 전략은 적당한 조건을 찾아 문제를 쉽게 만드는 것   
세부적인 전략은 첫 단계에 조건을 세우는 것이다.     
첫 단계에 조건을 세우는게 유용한 문제들이 많다.  
하지만 모든 조건안에 쓸 수는 없으니 단순한 조건을 가져야한다.   

![image](https://user-images.githubusercontent.com/50114210/72660442-73361280-3a11-11ea-8e10-0dfd9f384e59.png)      

이 문제의 특이한 점은 일반적인 문제가 더 풀기 쉽다는 것이다.     
pi는 전체 확률의 법칙에 따르는 것이다.   
Pi = A가 첫 라운드를 이길 확률(PP+1 _ QPi-1, 1<= i <= N-1)       
p0은 0이 된다. PN은 B가 파산한 상태로 시작하는 경우다. 1이다.      

경계 조건이 아닌 경우는 P가 p+1과 p-1과 연과노디어 있다.     

### 계차 방정식
이 문제를 다시 쓴다면 쉽게 풀 수 있다.    
한 항이 다른 항을 정의하는 재귀식을 계차방적식이라고 부른다.     
계차 방정식은 미분 방정식의 이산 형태다.       
계차방정식은 미분방정식만큼 중요한데 이산적인 형태를 띄고 있는 것이다.   
이 식은 많은 곳에서 나오고 현실적이다.    
관측은 이산적인 시간에서만 가능하기 때문이다.      
계차방정식을 미분 방정식으로 근사할 수 있지만 계차방정식을 직접 푸는게 베스트     

#### 계차 방정식 풀이
![image](https://user-images.githubusercontent.com/50114210/72660698-5818d200-3a14-11ea-9c06-72891c7375be.png)       

Pi = P x P(i+1) + Q x P(i-1)         
P와 Q가 주어졌다고 생각하고 방정식을 풀어보자.    
계차방정식과 미분방정식 사이에는 깊은 관계가있다.      
미분방정식을 푸는 방법 중 유명한 방법 중 하나는 예측하는 것    
계차방정식도 이렇게 풀면 답은 알 수 없지만 좋은 힌트를 줄것이다.      
이 추측은 문제 풀이 뿐만 아니라 계차방정식을 풀 때 일반적으로 좋은 추측이다.       
지수를 추측하면 많은 것을 알 수 있다.      

x를 치환하면
![image](https://user-images.githubusercontent.com/50114210/72660703-6ebf2900-3a14-11ea-951a-2f6a3f4dfca1.png)      
한 해는 x가 0일때이다. 하지만 경계조건을 만족하지도 않아서 별로 맘에 안 듬   
x가 0이 아니라고 가저앟고 x를 나눠주자.         

![image](https://user-images.githubusercontent.com/50114210/72660713-a4fca880-3a14-11ea-90e7-e387887ca21b.png)     
추측이 맞다면 이 이차방정식을 만족해야한다.   
이차방정식의 x는 구하기 쉽다.     

![image](https://user-images.githubusercontent.com/50114210/72660724-c8bfee80-3a14-11ea-9aba-cf87ac9a0b31.png)     
이 식을 대입해서 위 식을 만족하는지 살펴보자.     
근데 만족시키지 않는다 ㅎ 좀더 노력해보자.   

p = 1-q니까     
![image](https://user-images.githubusercontent.com/50114210/72660732-fad15080-3a14-11ea-9278-b03ae0b344be.png)   
해는 1과 q/p이다.      
확률은 1아니면 q/p이다.   
위의 조건들은 식은 만족하지만 경계조건은 만족하지 않는다.   
![image](https://user-images.githubusercontent.com/50114210/72660754-45eb6380-3a15-11ea-8fdd-ea11c59dec5f.png)      
일반적으로 계차방정식이 있다면 다항식의 해를 찾아 모두 다르다면
일반해는 그 해의 선형 결합이 된다.   
n개의 해가 있다면 그 해의 선형 결합이된다.    

p0=0을 대입하면 B = -A이다.     
pN=1을 대입하면 1 = A(1 - q/p)^n이 된다.     
이제 답을 구할 수 있다    

#### P != Q
![image](https://user-images.githubusercontent.com/50114210/72660782-d164f480-3a15-11ea-8040-58ed31da2ec1.png)

#### P == Q
중복도를 처리해줘야해서 극한으로 이해하자..?        
![image](https://user-images.githubusercontent.com/50114210/72660813-23a61580-3a16-11ea-9e46-c83f7c1dec86.png)        

답은 i/N       

### 해가 맞지 않는다면..?
해가 맞지 않을 수도 있단다!     
직관적으로 게임이 더 공평해진다면 위의 불공평한 게임은 공평한 게임의 해로 수렴해야한다.    
중요한 것은 조건적으로 생각하는 것과    
위의 문제의 구조를 이해하는 것이다.    

### 이 문제에서 가져가야할 교훈  
i/N은 직관적이어서 기억하기 쉽다.    
A가 이길 확률이 A가 가진 재산의 크기와 비례하기 때문이다.    
불공평할 경우에는 어떨까?   
N이 20이고, p가 0.49라면?     
![image](https://user-images.githubusercontent.com/50114210/72660846-a3cc7b00-3a16-11ea-8564-9bffab8418d7.png)     
A가 이길확률은 0.4퍼센트이다.    

N이 100일 때엔 A가 이길 확률은 12%이다.   

N이 200이라면 A가 이길 활류은 2%이다.     

게임이 조금만 불공평해도 엄청나게 큰 차이가 나게된다.    
카지노는 우리가 가진 돈 보다 많고 확률도 우리가 불리하니까   
카지노가 텅장이 될리는 없다.     
이 문제가 도박꾼의 파산으로 불리는 이유가 이것이다.   

### 일반적인 경우   
B가 이기고 A가 파산하는 확률       
공평한 게임에선 B가 이길 확률이 (N-i) / N이고 A가 이길확률인 1/N과 더했을 때의 합이 1이니까    
게임이 영원히 지속될 확률은 0이된다고 말할 수 있다.     
수학적으로 식을 봤을 때 게임이 영원히 지속되는건 불가능하지 않지만     
실제로 일어날 확률은 0이다.    
게임이 끝날 확률을 따로 계산할 필요가 없다.      

# 확률 변수  
확률변수가 왜 필요할까?    
표기법이 다루기 힘들어지기 때문     
확률 변수의 정의 :        
확률 변수의 정의는 임의의 값을 가지는 변수라고 되어있는데 아무것도 알려주지 못한다.      

### 변수란?
확률변수를 알기 전에 변수가 뭔지 알아야함      
변수의 정의 : 
x는 상수를 뜻하는 기호일 뿐이다      
변수라는 것을 정의하려면 함수가 필요하다.    
그때 그 때 변하는 무언가를 표현하기 위해서 이다.     

### 확률 변수의 정의
![image](https://user-images.githubusercontent.com/50114210/72661168-89949c00-3a1a-11ea-9174-50f994c81e3f.png)     

확률 변수는 실제로 함수이다.    
여기서 이해해야할 중요한 것은 무작위성이 오는 곳이다.      
확률 변수는 함수이고 S라고 불렀던 표본 공간안의 함수이다.    
실수에 대한 확률 시행이 있다는 것이고     
입력 값으로는 표본공간이 있다.    
확률1 시행은 다양한 값이 있는데 입력값은 실수값에 대응하게 된다.      
확률변수는 표본 공간에서 실수로 가는 함수이다.      
임의성이 어디서 오는지 말하면 임의성은 확률 시행에서 온다.    
다른 결과에 대해 다른 확률을 부여하게 된다.     
다른 사건은 다른 확률을 가진다.     
확률 시행이 끝난 뒤에는 특정 결과를 관찰하게 되는데 
S라는 표본 공간을 가지게되는 것이다.        
그리고 그걸 실수로 대입하게 되고     
실수는 다루기 쉽고 익숙하다는 장점을 가지게 된다.       

### 확률 변수 예제
![image](https://user-images.githubusercontent.com/50114210/72661218-25bea300-3a1b-11ea-840e-ca31d6146f05.png)   

상수가 아닌 가장 간단한 것은 값을 두개 가지는 것이다.      
베르누이 분포의 정의이다.    
확률 변수 x가 베르누이 분포를 따른다는 건     
x가 두개의 값만 가질 수 있다면 0과 1 두값만 가질 수 있다고 하면     
Bern(p)라고 부를 수 있다.   
![image](https://user-images.githubusercontent.com/50114210/72661297-83eb8600-3a1b-11ea-9a04-e6e52b6c8ab4.png)         

x가 1일 확률이 p이면 x가 0일 확률은 1-p가 될 것이다.     
이 말은 어떤 확률 시행이 있을 때 결과에 상관없이 0이나 1로 대응하게 된다는 것이다.      
x = 1이라는 표기법은 다음번에 더 다루게 될텐데 한 사건을 의미한다.     
이게 사건이 아니라면 아무 뜻도 없게 된다.      
P(x=1) = p , P(x=0) = 1-p      
시행하기 전에는 x값을 모르지만 시행 후에는 x의 값이 0이나 1로 정의된다.    

# 이항 분포    
![image](https://user-images.githubusercontent.com/50114210/72661332-e3e22c80-3a1b-11ea-8311-838197c8fbb1.png)      

Binomial(n, p)     
이항 분포는 성공 횟수의 분포다.     
성공은 맘대로 정의할 수 있는데      
n개의 독리적인 Bern(p)동안의 성공 횟수의 분포이다.    
베르누이 분포는 하나의 사건을 뜻하고 성공인 1과 0을 가지고    
n개의 독립적인 사건이 있고 0과 1로 나눌 수 있으면 뭐든 괜찮다.      
n개의 독립적인 가정에서 성공의 분포는    
bin(n, p)라고 하고 그 분포를 살펴보자.     
분포는 확률 변수의 청사진과 비슷하다.         
k번 성공할 확률을 알고 싶다면     
계산은 간단하다.    
![image](https://user-images.githubusercontent.com/50114210/72661354-39b6d480-3a1c-11ea-9893-fa5874a1aa2c.png)     
k번 성공하고 n-k번 실패하는 경우이다.      
PMK는 확률 질량함수라는 뜻이고     
k는 0과 n사이이다.    

이항 분포에 대해 더 덧붙이자면     
x가 n개의 베르누이 시행 중 성공횟수라는 것을 의미한다.   
Y도 Bin(n, p)라고하면     
x + y ~ Bin(m + n, p)라고 한다.    
![image](https://user-images.githubusercontent.com/50114210/72661379-7be01600-3a1c-11ea-8982-a5b50e5dd8ad.png)      
n개의 베르누이 시행해 m개의 시행을 추가하면 된다.   
다 독립적이 사건이기 때문에 같다.       








 








